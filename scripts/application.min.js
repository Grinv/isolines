(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=function(a,b){function c(){this.constructor=a}for(var d in b)v.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},v={}.hasOwnProperty,w=function(a,b){return function(){return a.apply(b,arguments)}};s=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},t=function(a,b){return s(0,8)*a+b},o=function(){function a(){var a;a=new Image,a.src=this.src,a.onload=function(a){return function(){return a.loaded=!0}}(this),this.image=a}return a.prototype.loaded=!1,a.prototype.src="images/sprite_sheet.png",a}(),n=function(){function a(a){this.game=a}return a.prototype.sx=0,a.prototype.sy=0,a.prototype.sw=0,a.prototype.sh=0,a.prototype.dx=0,a.prototype.dy=0,a.prototype.dw=0,a.prototype.dh=0,a.prototype.image=new o,a.prototype.drawImage=function(a,b,c,d){return this.image.loaded?this.game.ctx.drawImage(this.image.image,a,b,this.sw,this.sh,c,d,this.dw,this.dh):void 0},a}(),m=function(a){function b(a){b.__super__.constructor.call(this,a)}return u(b,a),b.prototype.sw=64,b.prototype.sh=64,b.prototype.dw=64,b.prototype.dh=64,b.prototype.draw=function(a,b){return this.dx=a,this.dy=b,this.drawImage(this.sx,this.sy,this.dx,this.dy)},b}(n),r=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sy=128,b}(m),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sx=64,b.prototype.sy=128,b}(m),j=function(a){function b(a){b.__super__.constructor.call(this,a)}return u(b,a),b.prototype.sw=64,b.prototype.sh=64,b.prototype.dw=64,b.prototype.dh=64,b.prototype.sx=128,b.prototype.sy=128,b.prototype.draw=function(a,b){return this.dx=a,this.dy=b,this.drawImage(this.sx,this.sy,this.dx,this.dy)},b}(n),h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sx=192,b.prototype.sw=64,b.prototype.sh=64,b.prototype.dw=64,b.prototype.dh=64,b.prototype.draw=function(a,b){return this.drawImage(this.sx,this.sy,a,b)},b}(n),b=function(a){function b(a){b.__super__.constructor.call(this,a)}return u(b,a),b.prototype.sw=64,b.prototype.sh=64,b.prototype.dw=64,b.prototype.dh=64,b.prototype.draw=function(a,b){return this.dx=a,this.dy=b,this.drawImage(this.sx,this.sy,this.dx,this.dy)},b}(n),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b}(b),l=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sx=64,b}(b),k=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sx=128,b}(b),q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sy=64,b}(b),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sy=64,b.prototype.sx=64,b}(b),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sy=64,b.prototype.sx=128,b}(b),p=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return u(b,a),b.prototype.sy=64,b.prototype.sx=192,b}(b),i=function(){function a(a){var b,c;this.gridSize=a.length,this.grid=function(){var d,e,f;for(f=[],b=d=0,e=this.gridSize;e>=0?e>d:d>e;b=e>=0?++d:--d)f.push(function(){var d,e,f;for(f=[],c=d=0,e=this.gridSize;e>=0?e>d:d>e;c=e>=0?++d:--d)-1===a[b][c]?f.push(1/0):f.push("x");return f}.call(this));return f}.call(this)}return a.prototype.grid=[],a.prototype.gridSize=0,a.prototype.getNeighbors=function(a){var b,c,d,e;return b=[],d=a.x,e=a.y,d-1>=0&&(c=this.grid[d-1][e],"x"!==c&&b.push({x:d-1,y:e,val:c})),e-1>=0&&(c=this.grid[d][e-1],"x"!==c&&b.push({x:d,y:e-1,val:c})),d+1<this.gridSize&&(c=this.grid[d+1][e],"x"!==c&&b.push({x:d+1,y:e,val:c})),e+1<this.gridSize&&(c=this.grid[d][e+1],"x"!==c&&b.push({x:d,y:e+1,val:c})),b},a.prototype.find=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(p=[],q=[],g=!1,this.grid[a][b]=0,s=a,t=b,r={x:s,y:t},q.push(r);q.length>0&&!g;)for(f=q.shift(),e=this.grid[f.x][f.y],o=this.getNeighbors(f),h=0,j=o.length;j>h;h++)if(n=o[h],n.val===1/0&&(this.grid[n.x][n.y]=e+1,q.push(n),c===n.x&&d===n.y)){g=!0;break}if(g)for(e=this.grid[c][d],f={x:c,y:d},p.unshift({x:c,y:d});e>0;){for(o=this.getNeighbors(f),m=o.pop(),l=this.grid[m.x][m.y],i=0,k=o.length;k>i;i++)n=o[i],n.val<m.val&&(m=n);p.unshift(m),f=m,e--}return p},a}(),a=Zepto,a(function(){var a;return a=new f,a.run()}),f=function(){function b(){this.update=w(this.update,this),this.ctx=this.createCanvas(),this.gridSprite=new h(this),this.ballSprites.push(new g(this)),this.ballSprites.push(new l(this)),this.ballSprites.push(new k(this)),this.ballSprites.push(new q(this)),this.ballSprites.push(new d(this)),this.ballSprites.push(new c(this)),this.ballSprites.push(new p(this)),this.selectionSprites.push(new r(this)),this.selectionSprites.push(new e(this)),this.pathSprite=new j(this),this.initBallsPosition(),this.initInputHandler()}return b.prototype.viewWidth=616,b.prototype.viewHeight=616,b.prototype.gridOffset=20,b.prototype.tileSize=64,b.prototype.ballSprites=[],b.prototype.fieldSize=9,b.prototype.field=[],b.prototype.mouseSelections=[],b.prototype.selectionSprites=[],b.prototype.pathNodes=[],b.prototype.createCanvas=function(){var b;return b=document.createElement("canvas"),b.width=this.viewWidth,b.height=this.viewHeight,a(".container .game").append(b),b.getContext("2d")},b.prototype.initBallsPosition=function(){var a,b,c,d,e,f,g,h;for(this.field=new Array(this.fieldSize),b=c=0,e=this.fieldSize;e>=0?e>c:c>e;b=e>=0?++c:--c)this.field[b]=new Array(this.fieldSize);for(g=[],b=d=0,f=Math.pow(this.fieldSize,2);f>=0?f>d:d>f;b=f>=0?++d:--d)a=b%this.fieldSize,h=b/this.fieldSize|0,g.push(this.field[h][a]=Math.max(-1,s(-12,6)));return g},b.prototype.run=function(){return this.update()},b.prototype.update=function(){var a;return a=(new Date).getTime(),this.render(a-this.lastUpdate),this.lastUpdate=a,window.requestAnimationFrame(this.update)},b.prototype.render=function(a){return this.renderField(),this.renderMouseSelection(),this.renderDebugOverlay(a)},b.prototype.drawSprite=function(a,b,c){var d,e;return d=b*this.tileSize+this.gridOffset,e=c*this.tileSize+this.gridOffset,a.draw(d,e)},b.prototype.renderField=function(){var a,b,c,d,e,f;for(e=[],b=c=0,d=Math.pow(this.fieldSize,2);d>=0?d>c:c>d;b=d>=0?++c:--c)a=b%this.fieldSize,f=b/this.fieldSize|0,this.drawSprite(this.gridSprite,a,f),this.field[a][f]<0||e.push(this.drawSprite(this.ballSprites[this.field[a][f]],a,f));return e},b.prototype.renderPath=function(){var a,b,c,d,e,f,g,h;if(this.pathNodes.length>0){for(f=this.pathNodes,a=f[0],c=f[f.length-1],this.drawSprite(this.selectionSprites[0],a.x,a.y),this.drawSprite(this.selectionSprites[1],c.x,c.y),g=this.pathNodes,h=[],b=0,d=g.length;d>b;b++)e=g[b],h.push(this.drawSprite(this.pathSprite,e.x,e.y));return h}},b.prototype.renderDebugOverlay=function(a){var b;return this.ctx.fillStyle="#10161C",this.ctx.fillRect(0,0,80,20),b=Math.round(1e3/a)+" FPS",this.ctx.fillStyle="white",this.ctx.font="Bold 15px Helvetica",this.ctx.fillText(b,5,15)},b.prototype.renderMouseSelection=function(){var a,b,c,d,e,f;for(a=0,d=this.mouseSelections,e=[],b=0,c=d.length;c>b;b++)f=d[b],this.drawSprite(this.selectionSprites[a],f.x,f.y),e.push(a++);return e},b.prototype.getSelection=function(a,b){var c;return c={},a>this.gridOffset&&a<this.viewWidth-this.gridOffset&&b>this.gridOffset&&b<this.viewHeight-this.gridOffset?(c.x=(a-this.gridOffset)/this.tileSize|0,c.y=(b-this.gridOffset)/this.tileSize|0,c):null},b.prototype.isTileFree=function(a,b){return this.field[a][b]<0},b.prototype.constructPath=function(){var a,b,c,d,e;return c=new i(this.field),d=this.mouseSelections[0].x,e=this.mouseSelections[0].y,a=this.mouseSelections[1].x,b=this.mouseSelections[1].y,c.find(d,e,a,b)},b.prototype.initInputHandler=function(){return a("canvas").on("click",function(b){return function(c){var d,e,f,g,h,i,j;if(f=a("canvas").offset(),i=c.clientX-f.left,j=c.clientY-f.top,d=b.getSelection(i,j),null!=d)switch(b.mouseSelections.length){case 0:if(!b.isTileFree(d.x,d.y))return b.mouseSelections.push(d),b.pathNodes=[];break;case 1:return b.isTileFree(d.x,d.y)?(b.mouseSelections.push(d),g=b.constructPath(),g.length>0?(e=g[0],h=g[g.length-1],b.field[h.x][h.y]=b.field[e.x][e.y],b.field[e.x][e.y]=-1,b.mouseSelections.shift()):b.mouseSelections.pop()):(b.mouseSelections=[],b.pathNodes=[],b.mouseSelections.push(d))}}}(this))},b}()}).call(this);